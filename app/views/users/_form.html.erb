<%= form_for(@user) do |f| %>
  <div id="input_form" class="col-xs-10 col-sm-4 col-md-4 col-lg-4">
    <% if session[:role] == "Admin" %>
      <div class="field">
        <%= label :role_id, "Role" %><br>
        <%= select_tag(:role, options_for_select(Role.dropdown_options, :selected => Role.selected(@role))) %>
      </div>
    <%end%>
      <div class="field">
        <%= f.label :name, t('name') %><br>
        <%= f.text_field :name %>
      </div>
      <div class="field">
        <%= f.label :surname, t('surname') %><br>
        <%= f.text_field :surname %>
      </div>
      <div class="field">
        <%= f.label :email, "Email" %><br>
        <%= f.text_field :email %>
      </div>
      <div class="field">
        <%= f.label :password, t('password') %><br>
        <%= f.password_field :password_digest %>
      </div>

      <% if flash[:notice] %>
      <div class="warning warning-error" style="color:#dd4b39;">
        <%= t('signup_error') %>
      </div>
    <% end %>

      <div class="actions">
        <% if session[:role] == "Admin" %>
          <%= f.submit "Submit", :id => "submit_form" %>
        <% else %>
          <%= f.submit "REGISTER", :id => "submit_form" %>
        <% end %>
        </div>
      </div>

<% end %>

<script>
$(function() {
  var user_name = $("#user_name");
  var user_surname = $("#user_surname");
  var user_email = $("#user_email");
  var user_password = $("#user_password_digest");
  var submit = $("#submit_form");
  // Functions
  function show_warning(field) {
    $(".warning-error").remove();

    field.css("border-color", "#dd4b39"); 
    var warning_label = null;
    if (locale  == "bs")
      warning_label = $("<p></p>").text("Ovo polje ne mo≈æe ostati prazno.");
    else 
      warning_label = $("<p></p>").text("This field can't be empty.");
    warning_label.attr("class","warning");
    warning_label.css("color","#dd4b39");
    field.parent().append(warning_label);
  }
  function remove_warning(field) {
    field.parent().children("p").remove(".warning");
    field.css("border-color", "#b7b7b7");
  }
  function validate_field(field) {
    var number_of_children = field.parent().children().length;
    if (!field.val()) {
      if(number_of_children == 3) show_warning(field);
    }
    else {
      if (number_of_children > 3) remove_warning(field);
    }
  }
  //Onblur events 
  user_name.blur(function(){
    validate_field($(this));
  });
  user_surname.blur(function(){
    validate_field($(this));
  });
  user_email.blur(function(){
    validate_field($(this));
  });
  user_password.blur(function(){
    validate_field($(this));
  });
  // Onsubmit validation
  $("form").submit(function() {
    var has_empty = false;
    $("#user_name, #user_surname, #user_password, #user_email", this).each(function() {
      if(!$(this).val()) {
        has_empty = true;
        validate_field($(this));      
      }
    });
    if (has_empty)  {
      return false;
    }
    return true;
  });
});
</script>
